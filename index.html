<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Werewolf Online - ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            background-image: radial-gradient(circle at top right, #1e293b, #0f172a);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Animations */
        .screen {
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        .hide-screen {
            opacity: 0;
            transform: scale(0.95);
            pointer-events: none;
            position: absolute;
            visibility: hidden;
        }
        .show-screen {
            opacity: 1;
            transform: scale(1);
            position: relative;
            visibility: visible;
        }

        /* Toast UI */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            min-width: 250px;
            background: rgba(15, 23, 42, 0.9);
            border-left: 4px solid #ef4444;
            color: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success { border-left-color: #22c55e; }
        .toast.error { border-left-color: #ef4444; }
        .toast.info { border-left-color: #3b82f6; }

        /* 3D Card Flip */
        .flip-card {
            background-color: transparent;
            width: 300px;
            height: 450px;
            perspective: 1000px;
            margin: 0 auto;
            cursor: pointer;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .flip-card-front {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #334155;
        }
        .flip-card-front::after {
            content: "WEREWOLF\A‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà";
            white-space: pre;
            color: #ef4444;
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: 2px;
            line-height: 1.5;
        }
        .flip-card-back {
            background-color: #1e293b;
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
            border: 2px solid #ef4444;
        }
        .flip-card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div id="toast-container"></div>

    <div id="screen-login" class="screen show-screen glass-panel p-10 rounded-3xl w-full max-w-md text-center">
        <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-500 mb-2">WEREWOLF</h1>
        <p class="text-slate-400 mb-10 text-lg">‡∏Ñ‡∏∑‡∏ô‡∏ô‡∏µ‡πâ... ‡πÉ‡∏Ñ‡∏£‡∏à‡∏∞‡∏£‡∏≠‡∏î?</p>
        <div class="mb-6 relative">
            <input type="text" id="playerNameInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" 
                class="w-full px-5 py-4 bg-slate-800/80 border-2 border-slate-600 rounded-xl focus:outline-none focus:border-red-500 text-center text-xl transition-all shadow-inner text-white placeholder-slate-500">
        </div>
        <button id="btnSaveName" class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-bold py-4 px-4 rounded-xl shadow-lg hover:shadow-red-500/30 transition-all transform hover:-translate-y-1 text-xl">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô
        </button>
    </div>

    <div id="screen-lobby" class="screen hide-screen glass-panel p-8 rounded-3xl w-full max-w-3xl">
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 border-b border-slate-700 pb-6 gap-4">
            <h2 class="text-3xl font-bold">‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô <span class="text-red-500">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤</span></h2>
            <div class="flex items-center gap-4 bg-slate-800 px-4 py-2 rounded-full border border-slate-700">
                <span class="text-slate-400">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</span>
                <span id="displayPlayerName" class="font-bold text-white text-lg"></span>
                <button id="btnLogout" class="text-xs bg-red-500/20 text-red-400 px-3 py-1 rounded-full hover:bg-red-500 hover:text-white transition-colors">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-slate-800/40 p-8 rounded-2xl border border-slate-700 hover:border-red-500/50 transition-all group">
                <h3 class="text-2xl font-bold mb-6 text-white group-hover:text-red-400 transition-colors">‡∏ï‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h3>
                <input type="text" id="roomNameInput" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á..." class="w-full mb-5 px-4 py-3 bg-slate-900/80 rounded-xl border border-slate-600 focus:border-red-500 focus:outline-none text-white">
                <div class="flex justify-between items-center mb-8">
                    <label class="text-slate-300">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</label>
                    <select id="playerCount" class="bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:border-red-500 focus:outline-none text-white font-bold">
                        <option value="5">5 ‡∏Ñ‡∏ô</option>
                        <option value="7">7 ‡∏Ñ‡∏ô</option>
                        <option value="10" selected>10 ‡∏Ñ‡∏ô</option>
                    </select>
                </div>
                <button id="btnCreateRoom" class="w-full bg-red-600 hover:bg-red-500 py-3 rounded-xl font-bold transition-all shadow-lg text-lg">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô</button>
            </div>

            <div class="bg-slate-800/40 p-8 rounded-2xl border border-slate-700 hover:border-blue-500/50 transition-all flex flex-col justify-center group">
                <h3 class="text-2xl font-bold mb-6 text-white group-hover:text-blue-400 transition-colors text-center">‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏¥‡∏ç‡πÅ‡∏•‡πâ‡∏ß?</h3>
                <input type="text" id="joinRoomCode" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á 6 ‡∏´‡∏•‡∏±‡∏Å" class="w-full mb-6 px-4 py-4 bg-slate-900/80 rounded-xl border border-slate-600 focus:border-blue-500 focus:outline-none text-center text-2xl tracking-[0.2em] uppercase font-bold text-white placeholder-slate-600">
                <button id="btnJoinRoom" class="w-full bg-blue-600 hover:bg-blue-500 py-3 rounded-xl font-bold transition-all text-lg shadow-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏î‡πà‡∏ß‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="screen-room" class="screen hide-screen glass-panel p-8 rounded-3xl w-full max-w-4xl">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end border-b border-slate-700 pb-6 mb-8 gap-4">
            <div>
                <h2 id="roomTitleDisplay" class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</h2>
                <div class="flex items-center gap-3 mt-3">
                    <span class="text-slate-400">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏¥‡∏ç:</span>
                    <span id="roomIdDisplay" class="font-mono text-xl font-bold text-white bg-slate-800 px-4 py-1 rounded-lg border border-slate-600 tracking-widest">---</span>
                </div>
            </div>
            <div class="text-left md:text-right bg-slate-800/50 px-6 py-3 rounded-xl border border-slate-700">
                <span class="block text-sm text-slate-400 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á</span>
                <span class="font-bold text-xl text-green-400 flex items-center gap-2">
                    <span class="relative flex h-3 w-3">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                    </span>
                    ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (<span id="playerCountDisplay">1/10</span>)
                </span>
            </div>
        </div>

        <div class="bg-slate-900/60 rounded-2xl p-6 min-h-[250px] mb-8 border border-slate-700 shadow-inner">
            <h3 class="text-sm text-slate-400 mb-4 uppercase tracking-wider font-bold">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</h3>
            <div id="playerList" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-4">
            <button id="btnLeaveRoom" class="px-8 py-4 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-xl font-bold transition-all text-lg">‡∏´‡∏ô‡∏µ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á</button>
            <button id="btnStartGame" class="flex-1 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-xl font-bold text-xl shadow-lg hover:shadow-red-500/40 transition-all disabled:opacity-50 disabled:cursor-not-allowed">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏à‡∏Å‡πÑ‡∏û‡πà!</button>
        </div>
    </div>

    <div id="screen-game" class="screen hide-screen w-full max-w-4xl flex flex-col items-center justify-center">
        <h2 class="text-3xl md:text-5xl font-extrabold text-white mb-4 drop-shadow-lg text-center">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠...</h2>
        <p class="text-slate-300 mb-10 text-center bg-slate-900/50 px-6 py-2 rounded-full border border-slate-700 backdrop-blur-sm">‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ñ‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÜ ‡πÅ‡∏≠‡∏ö‡∏î‡∏π!)</p>
        
        <div class="flip-card" id="myCard">
            <div class="flip-card-inner" id="cardInner">
                <div class="flip-card-front">
                    </div>
                <div class="flip-card-back">
                    <img id="roleImage" src="" alt="Role Image" class="w-full h-full object-cover">
                </div>
            </div>
        </div>
        
        <div id="roleTextContainer" class="mt-8 opacity-0 transition-opacity duration-500 text-center glass-panel p-6 rounded-2xl max-w-lg">
            <h3 id="roleNameText" class="text-3xl font-bold text-red-400 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</h3>
            <p id="roleDescText" class="text-lg text-slate-200">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ</p>
        </div>

        <button id="btnBackToLobby" class="mt-10 px-8 py-3 bg-slate-800 hover:bg-slate-700 rounded-xl font-bold transition-all opacity-0 pointer-events-none">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAzA-3TJ4lcNOFUGoOVd8JhExoeIRxSsFU",
            authDomain: "wolf-ba81b.firebaseapp.com",
            projectId: "wolf-ba81b",
            storageBucket: "wolf-ba81b.firebasestorage.app",
            messagingSenderId: "310182298514",
            appId: "1:310182298514:web:804e92316d5aca0770b74b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // State
        let currentUser = "";
        let currentRoomId = null;
        let unsubscribeRoom = null;
        let isCardFlipped = false;

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        const roleData = {
            "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤": { img: "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤.jpg", desc: "‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ü‡πà‡∏≤‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô 1 ‡∏Ñ‡∏ô" },
            "‡∏ô‡∏≤‡∏á‡∏õ‡∏µ‡∏®‡∏≤‡∏à": { img: "‡∏ô‡∏≤‡∏á‡∏õ‡∏µ‡∏®‡∏≤‡∏à.jpg", desc: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏û‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏ù‡πà‡∏≤‡∏¢‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤)" },
            "‡∏Å‡∏≤‡∏°‡πÄ‡∏ó‡∏û": { img: "‡∏Å‡∏≤‡∏°‡πÄ‡∏ó‡∏û.jpg", desc: "‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏£‡∏Å ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≠‡∏á‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô (‡∏ï‡∏≤‡∏¢‡∏Ñ‡∏π‡πà)" },
            "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô": { img: "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô.jpg", desc: "‡πÑ‡∏•‡πà‡∏•‡πà‡∏≤‡∏´‡∏≤‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á" },
            "‡∏à‡∏≠‡∏°‡πÄ‡∏ß‡∏ó": { img: "‡∏à‡∏≠‡∏°‡πÄ‡∏ß‡∏ó.jpg", desc: "‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏π‡∏î‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ" },
            "‡∏ô‡∏±‡∏Å‡∏ö‡∏ß‡∏ä": { img: "‡∏ô‡∏±‡∏Å‡∏ö‡∏ß‡∏ä.jpg", desc: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏Å‡∏°)" },
            "‡∏ö‡∏≠‡∏î‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î": { img: "‡∏ö‡∏≠‡∏î‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î.jpg", desc: "‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÉ‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ô‡∏±‡πâ‡∏ô" },
            "‡πÄ‡∏ó‡∏û‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå": { img: "‡πÄ‡∏ó‡∏û‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå.jpg", desc: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà" },
            "‡πÄ‡∏à‡πâ‡∏≤‡∏ä‡∏≤‡∏¢": { img: "‡πÄ‡∏à‡πâ‡∏≤‡∏ä‡∏≤‡∏¢.jpg", desc: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏ß‡∏ï‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ú‡∏¢‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏à‡∏±‡∏î" },
            "‡∏ô‡∏≤‡∏¢‡∏û‡∏£‡∏≤‡∏ô": { img: "‡∏ô‡∏≤‡∏¢‡∏û‡∏£‡∏≤‡∏ô.jpg", desc: "‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏à‡∏±‡∏î ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ" },
            "‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏≤‡∏õ": { img: "‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏≤‡∏õ.jpg", desc: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô ‡∏ñ‡πâ‡∏≤‡πÇ‡∏î‡∏ô‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤‡∏Å‡∏±‡∏î‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ï‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤" }
        };

        // ‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏à‡∏Å‡πÑ‡∏û‡πà (‡πÄ‡∏ô‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤)
        const gameSetups = {
            5: ["‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤", "‡πÄ‡∏ó‡∏û‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå", "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô", "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô", "‡∏ö‡∏≠‡∏î‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î"],
            7: ["‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤", "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤", "‡πÄ‡∏ó‡∏û‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå", "‡∏ö‡∏≠‡∏î‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î", "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô", "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô", "‡∏ô‡∏≤‡∏¢‡∏û‡∏£‡∏≤‡∏ô"],
            10: ["‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤", "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤", "‡∏ô‡∏≤‡∏á‡∏õ‡∏µ‡∏®‡∏≤‡∏à", "‡πÄ‡∏ó‡∏û‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå", "‡∏ö‡∏≠‡∏î‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î", "‡∏ô‡∏±‡∏Å‡∏ö‡∏ß‡∏ä", "‡∏ô‡∏≤‡∏¢‡∏û‡∏£‡∏≤‡∏ô", "‡∏à‡∏≠‡∏°‡πÄ‡∏ß‡∏ó", "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô", "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô"]
        };

        // --- ‡∏£‡∏∞‡∏ö‡∏ö Custom UI Notification (Toast) ---
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type} flex items-center gap-3`;
            
            let icon = 'üîî';
            if(type === 'success') icon = '‚úÖ';
            if(type === 'error') icon = '‚ùå';

            toast.innerHTML = `<span class="text-xl">${icon}</span> <span class="font-medium">${message}</span>`;
            container.appendChild(toast);

            // Animate In
            setTimeout(() => toast.classList.add('show'), 10);

            // Animate Out & Remove
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ---
        function showScreen(screenId) {
            const screens = ['screen-login', 'screen-lobby', 'screen-room', 'screen-game'];
            screens.forEach(id => {
                const el = document.getElementById(id);
                if (id === screenId) {
                    el.classList.remove('hide-screen');
                    el.classList.add('show-screen');
                } else {
                    el.classList.remove('show-screen');
                    el.classList.add('hide-screen');
                }
            });
        }

        const generateRoomCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();

        // --- Init & Login ---
        window.addEventListener('DOMContentLoaded', () => {
            const savedName = localStorage.getItem('ww_name');
            if (savedName) {
                currentUser = savedName;
                document.getElementById('displayPlayerName').textContent = currentUser;
                showScreen('screen-lobby');
            }

            document.getElementById('btnSaveName').addEventListener('click', () => {
                const name = document.getElementById('playerNameInput').value.trim();
                if (name) {
                    localStorage.setItem('ww_name', name);
                    currentUser = name;
                    document.getElementById('displayPlayerName').textContent = currentUser;
                    showScreen('screen-lobby');
                    showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ${name}`, 'success');
                } else {
                    showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô!', 'error');
                }
            });

            document.getElementById('btnLogout').addEventListener('click', () => {
                localStorage.removeItem('ww_name');
                currentUser = "";
                document.getElementById('playerNameInput').value = "";
                showScreen('screen-login');
            });
        });

        // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á ---
        document.getElementById('btnCreateRoom').addEventListener('click', async () => {
            let roomName = document.getElementById('roomNameInput').value.trim();
            if (!roomName) roomName = `‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á ${currentUser}`;
            const maxPlayers = parseInt(document.getElementById('playerCount').value);
            const roomId = generateRoomCode();
            
            const btn = document.getElementById('btnCreateRoom');
            btn.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á...'; btn.disabled = true;

            try {
                await setDoc(doc(db, "rooms", roomId), {
                    name: roomName, host: currentUser, maxPlayers: maxPlayers,
                    status: "waiting", players: [currentUser], createdAt: new Date()
                });
                joinRoomUI(roomId, roomName);
                showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (e) {
                showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                console.error(e);
            }
            btn.innerHTML = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô'; btn.disabled = false;
        });

        // --- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á ---
        document.getElementById('btnJoinRoom').addEventListener('click', async () => {
            const codeInput = document.getElementById('joinRoomCode').value.trim().toUpperCase();
            if (!codeInput) return showToast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á", 'error');

            const btn = document.getElementById('btnJoinRoom');
            btn.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...'; btn.disabled = true;

            const roomRef = doc(db, "rooms", codeInput);
            const roomSnap = await getDoc(roomRef);

            if (roomSnap.exists()) {
                const data = roomSnap.data();
                if (data.status !== "waiting") { showToast("‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß!", 'error'); }
                else if (data.players.length >= data.maxPlayers && !data.players.includes(currentUser)) { showToast("‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!", 'error'); }
                else {
                    if (!data.players.includes(currentUser)) {
                        await updateDoc(roomRef, { players: arrayUnion(currentUser) });
                    }
                    joinRoomUI(codeInput, data.name);
                    showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                }
            } else {
                showToast("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ!", 'error');
            }
            btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏î‡πà‡∏ß‡∏ô'; btn.disabled = false;
        });

        // --- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ UI ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á ---
        function joinRoomUI(roomId, roomName) {
            currentRoomId = roomId;
            document.getElementById('roomIdDisplay').textContent = roomId;
            document.getElementById('roomTitleDisplay').textContent = roomName;
            showScreen('screen-room');

            unsubscribeRoom = onSnapshot(doc(db, "rooms", roomId), (docSnap) => {
                if (!docSnap.exists()) {
                    showToast("‡∏´‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∏‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß!", 'error');
                    leaveRoom(); return;
                }

                const data = docSnap.data();
                const listDiv = document.getElementById('playerList');
                listDiv.innerHTML = "";
                
                data.players.forEach(p => {
                    const isHost = p === data.host;
                    listDiv.innerHTML += `
                        <div class="bg-slate-800 p-4 rounded-xl border ${isHost ? 'border-red-500 shadow-[0_0_10px_rgba(239,68,68,0.3)]' : 'border-slate-600'} flex items-center gap-3 transform transition hover:scale-105">
                            <div class="w-3 h-3 rounded-full ${isHost ? 'bg-red-500 animate-pulse' : 'bg-green-500'}"></div>
                            <span class="font-bold truncate text-white">${p}</span>
                            ${isHost ? '<span class="text-xs bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full ml-auto">Host</span>' : ''}
                        </div>
                    `;
                });
                
                document.getElementById('playerCountDisplay').textContent = `${data.players.length}/${data.maxPlayers}`;
                
                const btnStart = document.getElementById('btnStartGame');
                if (currentUser === data.host) {
                    btnStart.disabled = false; 
                    btnStart.textContent = data.players.length === data.maxPlayers ? "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏à‡∏Å‡πÑ‡∏û‡πà!" : "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (‡∏Ñ‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)";
                } else {
                    btnStart.disabled = true;
                    btnStart.textContent = "‡∏£‡∏≠‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...";
                }

                // ‡∏™‡∏±‡πà‡∏á‡∏ï‡∏±‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏° ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô playing
                if (data.status === "playing") {
                    const myRole = data.roles[currentUser];
                    setupGameScreen(myRole);
                }
            });
        }

        // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (God System ‡πÅ‡∏à‡∏Å‡πÑ‡∏û‡πà) ---
        document.getElementById('btnStartGame').addEventListener('click', async () => {
            const roomRef = doc(db, "rooms", currentRoomId);
            const roomSnap = await getDoc(roomRef);
            const data = roomSnap.data();
            
            const pCount = data.players.length;
            let deckTemplate = gameSetups[pCount];
            
            if(!deckTemplate) {
                // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏™‡∏π‡∏ï‡∏£ ‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡∏°‡∏±‡πà‡∏ß‡πÜ ‡πÄ‡∏≠‡∏≤‡∏¢‡∏∑‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤ (‡∏£‡∏∞‡∏ö‡∏ö‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)
                deckTemplate = ["‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤"];
                for(let i=1; i<pCount; i++) deckTemplate.push("‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô");
                showToast("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡πá‡∏Ñ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô", "info");
            }

            // Shuffle Deck (Fisher-Yates)
            let deck = [...deckTemplate];
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }

            // Map Roles
            let rolesMap = {};
            data.players.forEach((player, idx) => {
                rolesMap[player] = deck[idx] || "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô";
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô Firebase
            await updateDoc(roomRef, {
                status: "playing",
                roles: rolesMap
            });
            showToast("‡πÅ‡∏à‡∏Å‡πÑ‡∏û‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "success");
        });

        // --- ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏û‡πà‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ---
        function setupGameScreen(roleName) {
            if(!roleName) {
                showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", "error");
                return;
            }
            
            // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£
            if(unsubscribeRoom) unsubscribeRoom();

            showScreen('screen-game');
            showToast("‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß!", "success");

            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î
            isCardFlipped = false;
            document.getElementById('myCard').classList.remove('flipped');
            document.getElementById('roleTextContainer').classList.remove('opacity-100');
            document.getElementById('btnBackToLobby').classList.remove('opacity-100', 'pointer-events-auto');

            const rData = roleData[roleName] || { img: "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô.jpg", desc: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó" };
            
            document.getElementById('roleImage').src = rData.img;
            document.getElementById('roleNameText').textContent = roleName;
            document.getElementById('roleDescText').textContent = rData.desc;
        }

        // --- ‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏•‡∏¥‡∏Å‡πÑ‡∏û‡πà ---
        document.getElementById('myCard').addEventListener('click', () => {
            if (!isCardFlipped) {
                document.getElementById('myCard').classList.add('flipped');
                isCardFlipped = true;
                
                // ‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
                setTimeout(() => {
                    document.getElementById('roleTextContainer').classList.add('opacity-100');
                    document.getElementById('btnBackToLobby').classList.add('opacity-100', 'pointer-events-auto');
                }, 400); // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏û‡πà‡∏û‡∏•‡∏¥‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
            }
        });

        document.getElementById('btnBackToLobby').addEventListener('click', () => {
            currentRoomId = null;
            showScreen('screen-lobby');
            showToast("‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß", "info");
        });

        document.getElementById('btnLeaveRoom').addEventListener('click', () => {
            if (unsubscribeRoom) unsubscribeRoom();
            currentRoomId = null;
            showScreen('screen-lobby');
            showToast("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "info");
        });
    </script>
</body>
</html>